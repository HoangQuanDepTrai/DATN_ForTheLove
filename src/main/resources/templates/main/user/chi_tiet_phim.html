<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">CHI_TIET_PHIM</title>
    <link rel="icon" href="/slider_1-main/image/ok.png" type="image/png">

    <link rel="stylesheet" href="/slider_1-main/css/style.css">

    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztCQT..."
            crossorigin="anonymous">
    <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
            rel="stylesheet">

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/slider_1-main/css/chi_tiet_phim.css">
    <!-- <link rel="stylesheet" href="/new/new-new.css"> -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- SweetAlert CSS -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <!-- Animate.css -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

</head>


<body>
<div th:replace="userViews/header:: .navbar"></div>
<!-- Modal -->
<div class="modal fade mt-5" id="exampleModal" tabindex="-1"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog customModal_demo_chiTiet">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="custom-btn-close"
                        data-bs-dismiss="modal" aria-label="Close">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Hiển thị trailer từ YouTube -->
                <iframe width="560" height="315" id="youtubeVideo"
                        th:src="'https://www.youtube.com/embed/' + ${movie.trailerUrl} + '?autoplay=1'"
                        title="YouTube video player" frameborder="0"
                        allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
                </iframe>
            </div>
            <div class="modal-footer">
                <div class="card-datve">
                    <div class="row g-0">
                        <div class="col-md-2">
                            <img th:src="${movie.image}" class="img-fluid rounded-start"
                                 alt="Poster phim">
                        </div>
                        <div class="col-md-10">
                            <div class="card-body">
                                <h5 class="card-title"
                                    th:text="${movie.movieName} + ' - ' + ${movie.genre}">
                                    Tên phim - Thể loại</h5>
                                <div class="tieu-de-nho1">
                                    Nội dung
                                    <p id="movieContent" class="mb-0"
                                       th:text="${movie.content.substring(0, 200) + '...'}"></p>
                                    <a id="toggleButton" onclick="toggleContent()">Xem thêm</a>
                                    <p id="fullContent" th:text="${movie.content}" style="display: none;"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- MODAL VIDEO -->
<div class="khung">
    <!-- Ảnh nền phim -->
    <img th:src="${movie.image_bg}"
         src="https://c.wallhere.com/photos/0d/a6/Marvel_Comics_Marvel_Super_Heroes_looking_at_viewer_digital_art_Iron_Man_superhero_armor_glowing_eyes-2258630.jpg!d"
         alt="" class="hero2">

    <div class="movie-card-big m-0 p-0">
        <div class="container-fluid p-0">
            <!-- Nút phát trailer -->
            <button href="" class="cover1" data-bs-toggle="modal" data-bs-target="#exampleModal">
                <i class="bi bi-play-fill"></i>
            </button>

            <!-- Ảnh bìa phim -->
            <a href="#" class="custom-img-chititet-phim" data-bs-toggle="modal" data-bs-target="#exampleModal">
                <img th:src="${movie.image}" alt="cover" class="cover custom-img-chititet-phim"
                     style="margin-top: 5%;"/>
            </a>

            <div class="hero">
                <div class="details">
                    <span class="ghdt" th:text="${movie.ageRestriction}+'+'"></span>
                    <div class="title1"
                         th:text="${movie.movieName.length() > 40 ? #strings.substring(movie.movieName, 0, 40) + '...' : movie.movieName}">
                    </div>
                    <div class="title2" th:text="${movie.genre}">The Battle of the Five Armies</div>
                </div>
            </div>

            <div class="description">
                <div class="column2 m-0">
                    <div class="tieu-de-nho1">
                        <p id="movieContent2" class="mb-0"
                           th:text="${movie.content.length() > 200 ? movie.content.substring(0, 200) + '...' : movie.content}">
                        </p>
                        <a id="toggleButton2" onclick="toggleContent2()">Xem thêm</a>
                        <p id="fullContent2" th:text="${movie.content}" style="display: none;"></p>
                    </div>

                    <!-- Diễn viên -->
                    <span class="tieu-de-nho1"> Diễn viên
                        <p th:utext="${#strings.arrayJoin(movie.actor.split('\.'), '.<br>')}"></p>
                    </span>

                    <span class="tieu-de-nho">
                        <div class="tieu-de-item">
                            <span>Độ tuổi</span>
                            <p th:text="${movie.ageRestriction}+'+'"></p>
                        </div>
                        <div class="tieu-de-item">
                            <span>Thời lượng</span>
                            <p th:text="${movie.duration}+' phút'"></p>
                        </div>
                        <div class="tieu-de-item">
                            <span>Thể loại</span>
                            <p th:text="${movie.genre}"></p>
                        </div>
                        <div class="tieu-de-item">
                            <span>Đạo diễn</span>
                            <p th:text="${movie.director}"></p>
                        </div>

                        <!-- Ngày dự kiến ra mắt -->
                        <div th:if="${releaseDate != null}" class="tieu-de-item">
                            <span>Ngày dự kiến ra mắt:</span> 
                            <p th:text="${#temporals.format(releaseDate, 'dd-MM-yyyy')}"></p>
                        </div>

                        <!-- Hiển thị các ca chiếu -->
                        <!--                        <th:block th:if="${showtimes != null and showtimes.size() > 0}">

                                                </th:block>-->

                    </span>


                    <div class="cinema">
                        <span class="title-xc">Rạp Chiếu</span>
                        <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                            <!-- Lặp qua từng rạp trong danh sách cinemaAll và tạo các item cho danh sách -->
                            <th:block th:each="cinema, iter : ${cinemaAll}">
                                <li class="nav-items" role="presentation">
                                    <button class="nav-links" th:classappend="${iter.index == 0} ? 'active'"
                                            th:id="'pills-cinema-' + ${cinema.cinemaId} + '-tab'"
                                            data-bs-toggle="pill"
                                            th:data-bs-target="'#pills-cinema-' + ${cinema.cinemaId}"
                                            type="button" role="tab"
                                            th:aria-controls="'pills-cinema-' + ${cinema.cinemaId}"
                                            th:aria-selected="${iter.index == 0} ? 'true' : 'false'">
                                        <span th:text="${cinema.cinemaName}"></span>
                                    </button>
                                </li>
                            </th:block>
                        </ul>

                        <div class="tab-content" id="pills-tabContent">
                            <span class="title-xc">Suất Chiếu</span>
                            <!-- Lặp qua từng rạp và hiển thị thông tin các suất chiếu của rạp trong tab nội dung -->
                            <th:block th:each="cinema, iter : ${cinemaAll}">
                                <div class="tab-pane fade" th:classappend="${iter.index == 0} ? 'show active'"
                                     th:id="'pills-cinema-' + ${cinema.cinemaId}"
                                     role="tabpanel"
                                     th:aria-labelledby="'pills-cinema-' + ${cinema.cinemaId} + '-tab'"
                                     tabindex="0">

                                    <!-- Kiểm tra nếu không có suất chiếu hợp lệ (ngày chiếu >= ngày hiện tại) -->
                                    <th:block
                                            th:if="${cinema.showtimes.?[showDate >= T(java.time.LocalDate).now()].isEmpty()}">
                                        <div class="no-showtimes-message text-center"
                                             style="margin-top: 20px;">
                                            <img src="https://homepage.momocdn.net/next-js/_next/static/public/cinema/not-found.svg"
                                                 alt="No Showtimes Icon" style="width: 100px; height: 100px;">
                                            <div style="font-size: 18px; font-weight: bold; margin-top: 10px; color: #1a1d20">
                                                Úi, Suất chiếu không tìm thấy.
                                            </div>
                                            <div style="font-size: 14px; color: #6c757d; font-weight: 400">
                                                Bạn hãy thử tìm ngày khác nhé
                                            </div>
                                        </div>
                                    </th:block>

                                    <!-- Hiển thị suất chiếu hợp lệ nếu có -->
                                    <div class="showtime-container">
                                        <th:block th:each="showtime : ${cinema.showtimes}">
                                            <th:block th:if="${showtime.showDate >= T(java.time.LocalDate).now()}">
                                                <div class="showtime-item">
                                                    <div class="room-name mb-2">
                                                        <span th:text="${#temporals.format(showtime.showDate, 'dd-MM-yyyy')}"></span>
                                                    </div>
                                                    <a href="javascript:void(0);" class="btnXuatChieu mt-5 me-2"
                                                       th:text="${showtime.room.roomName} + ' | ' + ${showtime.startTime} + ' ~ ' + ${showtime.endTime}"
                                                       th:attr="onclick='checkLoginBeforeBooking(' + ${showtime.showtimeId} + ')'">
                                                    </a>
                                                </div>
                                            </th:block>
                                        </th:block>
                                    </div>

                                </div>
                            </th:block>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>
</div>


<div class="container mt-3 mb-5">

    <div class="row">
        <div class="col-lg-8">
            <!--HTML PHIM CHIEU-->
            <div class="row">
                <div class="col-lg-3">
                    <div class="sidebar"><input placeholder="Tìm theo tên rạp ..." type="text"/>
                        <ul>
                            <li class="active"><img alt="CGV logo" height="30"
                                                    src="https://storage.googleapis.com/a1aa/image/uUmiXkYqi4I6MZCgwp1QKtvHPYrRAr4wJsfgmFnfkamqZ4wTA.jpg"
                                                    width="30"/> CGV Aeon Hà Đông
                            </li>
                            <li><img alt="CGV logo" height="30"
                                     src="https://storage.googleapis.com/a1aa/image/uUmiXkYqi4I6MZCgwp1QKtvHPYrRAr4wJsfgmFnfkamqZ4wTA.jpg"
                                     width="30"/> CGV Vincom Ocean Park
                            </li>
                            <li><img alt="CGV logo" height="30"
                                     src="https://storage.googleapis.com/a1aa/image/uUmiXkYqi4I6MZCgwp1QKtvHPYrRAr4wJsfgmFnfkamqZ4wTA.jpg"
                                     width="30"/> CGV Vincom Metropolis Liễu Giai
                            </li>
                            <li><img alt="CGV logo" height="30"
                                     src="https://storage.googleapis.com/a1aa/image/uUmiXkYqi4I6MZCgwp1QKtvHPYrRAr4wJsfgmFnfkamqZ4wTA.jpg"
                                     width="30"/> CGV Xuân Diệu
                            </li>
                            <li><img alt="CGV logo" height="30"
                                     src="https://storage.googleapis.com/a1aa/image/uUmiXkYqi4I6MZCgwp1QKtvHPYrRAr4wJsfgmFnfkamqZ4wTA.jpg"
                                     width="30"/> CGV Hồ Gươm Plaza
                            </li>
                            <li><img alt="CGV logo" height="30"
                                     src="https://storage.googleapis.com/a1aa/image/uUmiXkYqi4I6MZCgwp1QKtvHPYrRAr4wJsfgmFnfkamqZ4wTA.jpg"
                                     width="30"/> CGV Aeon Long Biên
                            </li>
                            <li><img alt="CGV logo" height="30"
                                     src="https://storage.googleapis.com/a1aa/image/uUmiXkYqi4I6MZCgwp1QKtvHPYrRAr4wJsfgmFnfkamqZ4wTA.jpg"
                                     width="30"/> CGV Vincom Trần Duy Hưng
                            </li>
                        </ul>
                        <div class="more">
                            <button> Xem thêm</button>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="content">
                        <div class="header">
                            <img alt="CGV logo" height="50"
                                 src="https://storage.googleapis.com/a1aa/image/uUmiXkYqi4I6MZCgwp1QKtvHPYrRAr4wJsfgmFnfkamqZ4wTA.jpg"
                                 width="50"/>
                            <div class="info">
                                <h2>
                                    Lịch chiếu phim CGV Aeon Hà Đông
                                </h2>
                                <p>
                                    Tầng 3, 4 | TTTM AEON MALL HÀ ĐÔNG, P. Dương Nội, Q. Hà Đông, Hà Nội
                                    <a href="#">
                                        [ Bản đồ ]
                                    </a>
                                </p>
                            </div>
                        </div>
                        <div class="dates">
                            <button class="active">
                                14
                                <br/>
                                Hôm nay
                            </button>
                            <button>
                                15
                                <br/>
                                Thứ 6
                            </button>
                            <button>
                                16
                                <br/>
                                Thứ 7
                            </button>
                            <button>
                                17
                                <br/>
                                Chủ nhật
                            </button>
                            <button>
                                18
                                <br/>
                                Thứ 2
                            </button>
                            <button>
                                19
                                <br/>
                                Thứ 3
                            </button>
                            <button>
                                20
                                <br/>
                                Thứ 4
                            </button>
                        </div>
                        <div class="movie">
                            <img alt="Movie poster" height="150"
                                 src="https://storage.googleapis.com/a1aa/image/ITx4tJ7z4oYLIZsXLTyeryc7PbdmhvjxVNs263F2ETl1Mc4JA.jpg"
                                 width="100"/>
                            <div class="details">
                                <h3>
                                    Ngày Xưa Có Một Chuyện Tình
                                    <span
                                            style="background-color: #ffcc80; padding: 2px 5px; border-radius: 3px; font-size: 12px;">
                                    16+
                                </span>
                                </h3>
                                <p>
                                    Lãng Mạn
                                </p>
                                <p>
                                    2D Phụ đề
                                </p>
                                <div class="times">
                                    <button>
                                        18:20 ~ 20:23
                                    </button>
                                    <button>
                                        20:20 ~ 22:23
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="movie">
                            <img alt="Movie poster" height="150"
                                 src="https://storage.googleapis.com/a1aa/image/ITx4tJ7z4oYLIZsXLTyeryc7PbdmhvjxVNs263F2ETl1Mc4JA.jpg"
                                 width="100"/>
                            <div class="details">
                                <h3>
                                    Robot Hoang Dã
                                    <span
                                            style="background-color: #a5d6a7; padding: 2px 5px; border-radius: 3px; font-size: 12px;">
                                    P
                                </span>
                                </h3>
                                <p>
                                    Khoa Học Viễn Tưởng, Hoạt Hình, Gia Đình
                                </p>
                                <p>
                                    2D Lồng tiếng
                                </p>
                                <div class="times">
                                    <button>
                                        19:50 ~ 21:40
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <section class="custom-comment-card">
                <div class="container my-5">
                    <span class="custom_td_col4">Những bình luận khi xem phim</span>
                    <div class="row d-flex">
                        <div class="col-md-12">
                            <div id="reviewList"> <!-- Thêm ID ở đây -->
                                <div th:id="'review-' + ${review.reviewId}" class="cardReview"
                                     th:each="review : ${reviews}">
                                    <div class="card-body">
                                        <div class="d-flex flex-start align-items-center">
                                            <img class="rounded-circle shadow-1-strong me-3"
                                                 src="/slider_1-main/image/logo-shop.jpg" alt="avatar" width="40"
                                                 height="40"/>
                                            <div>
                                                <h6 class="fw-bold text-black mb-1"
                                                    th:text="${review.account.fullName}">Lily Coleman</h6>
                                                <p class="hiddenReviewDate" style="display: none;"
                                                   th:text="${review.reviewDate}"></p>
                                                <p class="formattedReviewDate text-muted small mb-0"></p>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-11 text-start">
                                                <p class="mt-3 mb-4 pb-2 review-content" style="color: #1a1d20"
                                                   th:text="${review.content}">Lorem ipsum dolor sit amet...</p>
                                            </div>
                                            <div class="col-1 text-end">
                                                <div class="small d-flex justify-content-start">
                                                    <button th:if="${session.acc != null and session.acc.accountId == review.account.accountId}"
                                                            th:onclick="|deleteReview(${review.reviewId})|"
                                                            class="d-flex align-items-center mt-3 customDeleteReview">
                                                        <i class="bi bi-trash3-fill"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <!-- Chỉ hiển thị nút "Xem thêm" nếu có bình luận -->
                            <div class="mt-1" th:if="${#lists.size(reviews) > 0 && #lists.size(reviews) > 10}">
                                <button id="loadMoreBtn" class="icon-link">
                                    <i class="bi bi-chevron-down"></i> <!-- Biểu tượng mũi tên đi xuống -->
                                    Xem thêm
                                </button>
                            </div>

                        </div>
                    </div>

                    <div class="card-footer py-3 border-0 mt-2" style="background: #fff">
                        <div class="d-flex flex-start w-100">
                            <img class="rounded-circle shadow-1-strong me-3" src="/slider_1-main/image/logo-shop.jpg"
                                 alt="avatar" width="40" height="40"/>
                            <div class="form-outline w-100">
                                <textarea id="reviewContent" class="form-control"
                                          style="background: #fff; height: 90px;" placeholder="Bình luận"></textarea>
                            </div>
                        </div>
                        <div class="float-end mt-2 pt-1">
                            <button type="button" class="customBtnReviewPost me-2" id="postReviewBtn">Đăng</button>
                            <button type="button" class="customBtnReviewCancel" id="cancelReviewBtn">Hủy</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <div class="col-lg-4 mt-5" id="movieCardsContainer">
            <div class="mb-3">
                <span class="custom_td_col4">Phim đang chiếu</span>
            </div>
            <div th:each="showtimeDetail : ${showtimeDetails}"
                 class="card_MovieDetails">
                <div class="movie-card-chi-tiet ms-0 ps-0 mb-1 mt-0">

                    <img th:src="${showtimeDetail.image}" alt=""
                         th:onclick="'window.location.href=\'/index/details/' + ${showtimeDetail.movieId} + '\''"
                         style="cursor: pointer;"
                         class="movie-poster img-fluid">

                    <div class="movie-info">
                        <div class="movie-age-rating age-18"
                             th:text="${showtimeDetail.ageRestriction}+'+'">18+
                        </div>
                        <div class="movie-title"
                             th:text="${showtimeDetail.movieName.length() > 40 ? #strings.substring(showtimeDetail.movieName, 0, 40) + '...' : showtimeDetail.movieName}"
                             th:onclick="'window.location.href=\'/index/details/' + ${showtimeDetail.movieId} + '\''"
                             style="cursor: pointer;">
                            CÁM
                        </div>


                        <div class="movie-genre"
                             th:text="${showtimeDetail.genre.length() > 25 ? #strings.substring(showtimeDetail.genre, 0, 25) + '...' : showtimeDetail.genre}">
                            Kinh Dị
                        </div>
                    </div>
                    <a th:href="@{/index/details/{id}(id=${showtimeDetail.movieId})}"
                       class="movieDetails_btn">Xem</a>
                    <!-- <a
                        class="movieDetails_btn">Đặt vé</a>  -->
                </div>
            </div>
            <button id="loadMoreBtn_cardPhimDangChieu"
                    class="btn btn-primary mt-3 mb-5">Xem thêm
            </button>
        </div>
        <!-- đóng col-lg-4  -->

    </div>
    <!--đóng row  -->
</div>
<!-- đóng container -->


<div class="container-fluid" style="background: #151515">
    <div class="movie-list-container">
        <div class="movie-list-wrapper">
            <div class="movie-list">
                <!-- Sử dụng th:block để lặp qua danh sách phim -->
                <th:block th:each="movieDetail : ${movieDetails}">
                    <div class="movie-list-item">
                        <img class="movie-list-item-img" th:src="${movieDetail.image_bg}" alt="Movie Image">
                        <a class="movie-list-item-button" th:href="@{/index/details/{id}(id=${movieDetail.movieId})}">Chi
                            tiết</a>
                    </div>
                </th:block>
            </div>
            <i class="fas fa-chevron-right arrow"></i>
        </div>
    </div>

    <!--list 2-->
    <div class="movie-list-container">
        <div class="movie-list-wrapper">
            <div class="movie-list">
                <!-- Sử dụng th:block để lặp qua danh sách phim -->
                <th:block th:each="movieDetail : ${movieDetails}">
                    <div class="movie-list-item">
                        <img class="movie-list-item-img" th:src="${movieDetail.image}" alt="Movie Image">
                        <a class="movie-list-item-button" th:href="@{/index/details/{id}(id=${movieDetail.movieId})}">Chi
                            tiết</a>
                    </div>
                </th:block>
            </div>
            <i class="fas fa-chevron-right arrow"></i>
        </div>
    </div>
</div>


<!-- FOOTER -->
<div th:replace="userViews/footer:: footer"></div>
<!-- FOOTER -->
<script>
    function checkLoginBeforeBooking(showtimeId) {
        // Kiểm tra nếu tài khoản chưa đăng nhập
        if (!accId) {
            Swal.fire({
                title: "Vui lòng đăng nhập",
                text: "Bạn cần đăng nhập trước khi đặt vé.",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Đăng nhập",
                cancelButtonText: "Hủy"
            }).then((result) => {
                if (result.isConfirmed) {
                    // Điều hướng đến trang đăng nhập
                    window.location.href = "/login";
                }
            });
        } else {
            // Nếu đã đăng nhập, chuyển hướng đến trang đặt vé
            window.location.href = `/booking/${showtimeId}`;
        }
    }
</script>

<script>

    /*Mờ scrip video auto play  */
    $(document).ready(function () {
        // Khi modal được hiển thị
        $('#exampleModal').on('shown.bs.modal', function () {
            var iframe = $('#youtubeVideo');
            var currentSrc = iframe.attr('src');

            // Nếu src không có autoplay, thêm vào
            if (!currentSrc.includes('autoplay=1')) {
                iframe.attr('src', currentSrc + '?autoplay=1');
            }
        });

        // Khi modal bị đóng
        $('#exampleModal').on('hide.bs.modal', function () {
            // Xóa autoplay để video có thể bắt đầu từ đầu khi mở lại
            var iframe = $('#youtubeVideo');
            var currentSrc = iframe.attr('src');
            // Thay thế 'autoplay=1' với '' để dừng video
            iframe.attr('src', currentSrc.replace(/([&?])autoplay=1/, '')); // Xóa autoplay
        });
    });
    /*Đóng scrip video auto play  */

    /*Mờ scrip xem them text  */
    function toggleContent() {
        const contentElement = document.getElementById('movieContent');
        const fullContentElement = document.getElementById('fullContent');
        const buttonElement = document.getElementById('toggleButton');

        if (fullContentElement.style.display === "none" || fullContentElement.style.display === "") {
            // Hiển thị toàn bộ nội dung
            contentElement.style.display = "none";
            fullContentElement.style.display = "block";
            buttonElement.textContent = "Thu gọn";
        } else {
            // Hiển thị nội dung ngắn
            contentElement.style.display = "block";
            fullContentElement.style.display = "none";
            buttonElement.textContent = "Xem thêm";
        }
    }

    /*Đóng scrip xem them text  */
    function toggleContent2() {
        const contentElement = document.getElementById('movieContent2');
        const fullContentElement = document.getElementById('fullContent2');
        const buttonElement = document.getElementById('toggleButton2');

        if (fullContentElement.style.display === "none" || fullContentElement.style.display === "") {
            // Hiển thị toàn bộ nội dung
            contentElement.style.display = "none";
            fullContentElement.style.display = "block";
            buttonElement.textContent = "Thu gọn";
        } else {
            // Hiển thị nội dung ngắn
            contentElement.style.display = "block";
            fullContentElement.style.display = "none";
            buttonElement.textContent = "Xem thêm";
        }
    }

    /*Mờ scrip xem them card  */
    // JavaScript to handle Load More functionality
    const movieCards = document.querySelectorAll('.card_MovieDetails'); // Chọn tất cả thẻ phim
    const loadMoreBtn = document.getElementById('loadMoreBtn_cardPhimDangChieu');
    let visibleCards = 7; // Số thẻ ban đầu hiển thị

    // Ẩn tất cả các thẻ trừ 13 thẻ đầu tiên
    for (let i = visibleCards; i < movieCards.length; i++) {
        movieCards[i].style.display = 'none';
    }

    // Ẩn nút nếu không có đủ thẻ
    if (movieCards.length <= visibleCards) {
        loadMoreBtn.style.display = 'none';
    }

    // Hàm để tải thêm thẻ
    loadMoreBtn.addEventListener('click', function () {
        const newVisibleCards = visibleCards + 2; // Hiển thị thêm 2 thẻ mỗi lần
        for (let i = visibleCards; i < newVisibleCards && i < movieCards.length; i++) {
            movieCards[i].style.display = 'block'; // Hiển thị 2 thẻ bị ẩn tiếp theo
        }
        visibleCards = newVisibleCards;

        // Ẩn nút nếu đã hiển thị tất cả các thẻ
        if (visibleCards >= movieCards.length) {
            loadMoreBtn.style.display = 'none';
        }
    });


    document.addEventListener('DOMContentLoaded', () => {
        let loadMoreBtn = document.querySelector('#load-more');
        let currentItem = 9; // Number of boxes to display initially
        let loadMoreAmount = 3; // Number of boxes to display on each button click

        // Function to display boxes
        const displayBoxes = (start, count) => {
            let boxes = [...document.querySelectorAll('.container .box-container .box-card')];
            for (let i = start; i < start + count; i++) {
                if (boxes[i]) { // Check if the box exists
                    boxes[i].style.display = 'inline-block';
                }
            }
        }

        // Display 6 boxes initially
        displayBoxes(0, currentItem);

        loadMoreBtn.onclick = () => {
            let boxes = [...document.querySelectorAll('.container .box-container .box-card')];
            displayBoxes(currentItem, loadMoreAmount); // Show 3 more boxes
            currentItem += loadMoreAmount; // Increment the number of displayed boxes

            if (currentItem >= boxes.length) {
                loadMoreBtn.style.display = 'none'; // Hide button if no more boxes
            }
        }
    });
    /*Đóng scrip xem them card  */

    /*JS BTN CHUYEN CARD NGANG*/
    const arrows = document.querySelectorAll(".arrow");
    const movieLists = document.querySelectorAll(".movie-list");

    arrows.forEach((arrow, i) => {
        const itemNumber = movieLists[i].querySelectorAll("img").length;
        let clickCounter = 0;
        arrow.addEventListener("click", () => {
            const ratio = Math.floor(window.innerWidth / 270);
            clickCounter++;
            if (itemNumber - (4 + clickCounter) + (4 - ratio) >= 0) {
                movieLists[i].style.transform = `translateX(${
                    movieLists[i].computedStyleMap().get("transform")[0].x.value - 300
                }px)`;
            } else {
                movieLists[i].style.transform = "translateX(0)";
                clickCounter = 0;
            }
        });

        console.log(Math.floor(window.innerWidth / 270));
    });


    // Hàm xử lý đăng bình luận
    let currentReviewId = null; // Biến để lưu ID của bình luận hiện tại đang sửa
    var accId = null; // Khởi tạo accId với giá trị null
    var spanElement = document.getElementById("accId");
    if (spanElement) {
        accId = spanElement.textContent || null; // Lấy giá trị từ thẻ span
    }
    console.log("Tài khoản hiện tại là: " + accId);

    document.getElementById('cancelReviewBtn').addEventListener('click', function () {
        document.getElementById('reviewContent').value = null;
    });

    function postReview() {
        const content = document.getElementById('reviewContent').value.trim();
        if (!content) {
            Swal.fire({
                icon: "error",
                title: "Thông báo!",
                text: "Vui lòng nhập nội dung bình luận!",
            });
            return;
        }

        const currentDate = new Date();
        const reviewDate = currentDate.toISOString();
        const pathArray = window.location.pathname.split('/');
        const movieId = pathArray[pathArray.length - 1];
        const accountId = accId;

        if (accountId === null) {
            Swal.fire({
                title: "Vui lòng đăng nhập",
                text: "Bạn cần đăng nhập trước khi bình luận.",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Đăng nhập",
                cancelButtonText: "Hủy"
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = "/login";
                } else {
                    document.getElementById('reviewContent').value = null;
                }
            });
            return;
        }

        fetch(`/api/reviews/can-review?accountId=${accountId}&movieId=${movieId}`)
            .then(response => response.json())
            .then(canReview => {
                if (!canReview) {
                    Swal.fire({
                        icon: "warning",
                        title: "Thông báo!",
                        text: "Bạn phải mua vé xem phim này mới có thể bình luận.",
                    });
                    return;
                }

                const review = {
                    content: content,
                    account: {accountId: accountId},
                    movie: {movieId: movieId},
                    reviewDate: reviewDate
                };

                fetch('/api/reviews', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(review)
                })
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(errorData => {
                                throw new Error(errorData.error || 'Có lỗi xảy ra khi đăng bình luận.');
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Bình luận đã được đăng:', data);
                        location.reload(); // Tải lại trang sau khi đăng bình luận thành công
                    })
                    .catch(error => {
                        Swal.fire({
                            icon: 'error',
                            title: 'Thông báo!',
                            text: error.message
                        });
                        console.error('Lỗi khi đăng bình luận:', error);
                    });

                currentReviewId = null;
            })
            .catch(error => {
                console.error('Lỗi khi kiểm tra quyền bình luận:', error);
            });
    }


    document.getElementById('postReviewBtn').addEventListener('click', postReview);

    document.getElementById('reviewContent').addEventListener('keydown', function (event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            postReview();
        }
    });


    /*FOTMAT DATETIME*/
    // Hàm formatDate như bạn đã định nghĩa
    // Hàm định dạng ngày như bạn đã định nghĩa
    function formatDate(date) {
        const hours = String(date.getHours()).padStart(2, '0'); // Lấy giờ
        const minutes = String(date.getMinutes()).padStart(2, '0'); // Lấy phút
        const day = String(date.getDate()).padStart(2, '0'); // Lấy ngày
        const month = String(date.getMonth() + 1).padStart(2, '0'); // Lấy tháng
        const year = date.getFullYear(); // Lấy năm

        // Trả về chuỗi định dạng với màu sắc cho ngày
        return `${hours}:${minutes} <span style="color: #ff4971;">${day}-${month}-${year}</span>`;
    }

    // Hàm tính số ngày đã trôi qua kể từ ngày đăng
    function calculateDaysAgo(postedDate) {
        const currentDate = new Date(); // Ngày hiện tại
        const postDate = new Date(postedDate); // Ngày đăng từ chuỗi

        // Tính số mili-giây giữa hai ngày
        const timeDifference = currentDate - postDate;

        // Chuyển đổi mili-giây thành số ngày và cộng thêm 1 ngày
        const daysAgo = Math.floor(timeDifference / (1000 * 60 * 60 * 24)) + 1;

        // Kiểm tra nếu là 1 ngày (ngày đăng trong vòng 24 giờ qua), trả về "vừa đăng"
        return daysAgo === 1 ? "vừa đăng" : `${daysAgo} ngày trước`;
    }

    // Lấy tất cả các thẻ chứa ngày ẩn và ngày hiển thị
    const hiddenDates = document.querySelectorAll('.hiddenReviewDate');
    const formattedDates = document.querySelectorAll('.formattedReviewDate');

    // Kiểm tra số lượng thẻ có khớp nhau không
    if (hiddenDates.length === formattedDates.length) {
        hiddenDates.forEach((hiddenDateElement, index) => {
            const reviewDate = new Date(hiddenDateElement.innerText); // Ngày từ thẻ ẩn

            // Định dạng và tính số ngày trước
            const formattedDate = formatDate(reviewDate);
            const daysAgo = calculateDaysAgo(reviewDate);

            // Cập nhật nội dung thẻ hiển thị với ngày đã định dạng
            formattedDates[index].innerHTML = `Vào lúc ${formattedDate} (${daysAgo}).`;
        });
    } else {
        console.error('Số lượng thẻ chứa ngày ẩn và thẻ hiển thị không khớp!');
    }


    /*JS XÓA BÌNH LUẬN THEO ID*/
    // Hàm gọi API để xóa bình luận
    function deleteReview(reviewId) {
        Swal.fire({
            title: "Bạn muốn xóa bình luận này không?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Ok!",
            cancelButtonText: "Hủy", // Thay đổi văn bản nút hủy thành "Hủy"
            customClass: {
                title: 'my-title', // Tên lớp tùy chỉnh cho tiêu đề
                content: 'my-content' // Tên lớp tùy chỉnh cho nội dung
            }
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: `/api/reviews/${reviewId}`,
                    type: 'DELETE',
                    success: function (response) {
                        Swal.fire({
                            title: "Xóa bình luận thành công!",
                            icon: "success",
                            customClass: {
                                title: 'my-title',
                                content: 'my-content'
                            }
                        }).then(() => {
                            // Tìm và xóa phần tử bình luận trong DOM
                            const reviewElement = document.getElementById(`review-${reviewId}`);
                            if (reviewElement) {
                                reviewElement.remove(); // Xóa phần tử bình luận khỏi DOM
                            }
                        });
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        Swal.fire({
                            title: "Có lỗi xảy ra!",
                            text: "Vui lòng thử lại sau.",
                            icon: "error",
                            customClass: {
                                title: 'my-title',
                                content: 'my-content'
                            }
                        });
                    }
                });
            }
        });
    }

    /*CLOSE JS DELETE REVIEW*/

    document.addEventListener("DOMContentLoaded", function () {
        let reviewCards = document.querySelectorAll('.cardReview');
        let loadMoreBtn = document.getElementById('loadMoreBtn');
        let currentCount = 10; // Số thẻ review hiển thị ban đầu
        let loadMoreAmount = 3; // Số thẻ review hiển thị thêm mỗi lần nhấn nút

        // Hàm hiển thị thẻ review
        const displayReviews = (start, count) => {
            for (let i = start; i < start + count; i++) {
                if (reviewCards[i]) { // Kiểm tra nếu thẻ review tồn tại
                    reviewCards[i].classList.add('show'); // Thêm lớp show để hiển thị
                }
            }
        }

        // Hiển thị 3 thẻ review đầu tiên
        displayReviews(0, currentCount);

        loadMoreBtn.addEventListener('click', function () {
            displayReviews(currentCount, loadMoreAmount); // Hiển thị thêm thẻ review

            currentCount += loadMoreAmount; // Tăng số lượng thẻ review đã hiển thị

            // Ẩn nút "Xem thêm" nếu không còn thẻ review nào ẩn
            if (currentCount >= reviewCards.length) {
                loadMoreBtn.style.display = 'none'; // Ẩn nút nếu không còn thẻ review
            }
        });
    });


    /*JS KIỂM TRA PHẢI MUA PHIM ĐÓ MỚI COMMENT PHIM ĐÓ ĐƯỢC*/


    /*JS GET CINEMAID*/
    function submitCinemaId(cinemaId) {
        // Cập nhật giá trị cinemaId vào input ẩn
        document.getElementById('cinemaIdInput').value = cinemaId;

        // Submit form để gửi cinemaId
        document.getElementById('cinemaForm').submit();
    }


</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/slider_1-main/js/local.js"></script>

<script src="/slider_1-main/js/help.js"></script>
<script src="/slider_1-main/js/search.js"></script>

</body>
</html>